
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Object Oriented Programming &mdash; python_kobe 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.4/yeti/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="python_kobe 1.0 documentation" href="../../index.html" />
    <link rel="prev" title="5. Python Essentials(p48)" href="../python_essential/sec1.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          ROKKOPY</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/rokkopy/qe-seminar">Repo</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../notetaking/index.html">1. セミナーノート作成の手引き</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../notetaking/index.html#id2">1.1. はじめに</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notetaking/index.html#id3">1.2. 使用ツール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notetaking/index.html#git">1.3. Git のワークフロー &amp; 用語集</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../notetaking/index.html#sphinx">1.4. Sphinx</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../chap1/sec2.html">2. Pythonを勉強する周辺環境</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chap1/sec2.html#sphinx">2.1. Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chap1/sec2.html#id2">2.2. テキストエディタについて</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chap1/sec2.html#jupyterrst">2.3. JupyterノートブックをRSTに変換するプログラム</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../chap1/sec3.html">3. これまでの取り決めの流れ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chap1/sec3.html#git-hub">3.1. 勉強会でのGit Hubの使用法</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">4. Quantitative Economics with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_essential/sec1.html">5. Python Essentials(p48)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#data-type">5.1. Data Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#import">5.2. import</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#input-and-output">5.3. Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#iterating">5.4. Iterating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#comparisons-and-logical-operators">5.5. Comparisons and Logical Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#more-functions">5.6. More Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#why-write-functions">5.7. Why Write Functions?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_essential/sec1.html#exercises">5.8. Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">6. Object Oriented Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#defining-your-own-classes">6.1. Defining Your Own Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#special-methods">6.2. Special Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">6.3. Exercises</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">6. Object Oriented Programming</a><ul>
<li><a class="reference internal" href="#defining-your-own-classes">6.1. Defining Your Own Classes</a><ul>
<li><a class="reference internal" href="#class">6.1.1. 簡単なClassの例</a></li>
<li><a class="reference internal" href="#id5">6.1.2. 用語についての説明</a></li>
<li><a class="reference internal" href="#class-another-consumer-class">6.1.3. もう少し複雑なClassの例(Another Consumer Class)</a></li>
<li><a class="reference internal" href="#the-solow-growth-model">6.1.4. The Solow Growth Model</a></li>
<li><a class="reference internal" href="#a-market">6.1.5. A Market</a></li>
<li><a class="reference internal" href="#chaos">6.1.6. Chaos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#special-methods">6.2. Special Methods</a></li>
<li><a class="reference internal" href="#exercises">6.3. Exercises</a><ul>
<li><a class="reference internal" href="#exercise-1">6.3.1. Exercise 1</a></li>
<li><a class="reference internal" href="#exercise-2">6.3.2. Exercise 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../python_essential/sec1.html" title="Previous Chapter: 5. Python Essentials(p48)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 5. Python Essent...</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">6. Object Oriented Programming</a><ul>
<li><a class="reference internal" href="#defining-your-own-classes">6.1. Defining Your Own Classes</a><ul>
<li><a class="reference internal" href="#class">6.1.1. 簡単なClassの例</a></li>
<li><a class="reference internal" href="#id5">6.1.2. 用語についての説明</a></li>
<li><a class="reference internal" href="#class-another-consumer-class">6.1.3. もう少し複雑なClassの例(Another Consumer Class)</a></li>
<li><a class="reference internal" href="#the-solow-growth-model">6.1.4. The Solow Growth Model</a></li>
<li><a class="reference internal" href="#a-market">6.1.5. A Market</a></li>
<li><a class="reference internal" href="#chaos">6.1.6. Chaos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#special-methods">6.2. Special Methods</a></li>
<li><a class="reference internal" href="#exercises">6.3. Exercises</a><ul>
<li><a class="reference internal" href="#exercise-1">6.3.1. Exercise 1</a></li>
<li><a class="reference internal" href="#exercise-2">6.3.2. Exercise 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="sourcelink">
  <a href="../../_sources/chap2/oop/sec1.txt"
     rel="nofollow">Source</a>
</div>
<form action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="object-oriented-programming">
<h1>6. Object Oriented Programming<a class="headerlink" href="#object-oriented-programming" title="Permalink to this headline">¶</a></h1>
<div class="section" id="defining-your-own-classes">
<h2>6.1. Defining Your Own Classes<a class="headerlink" href="#defining-your-own-classes" title="Permalink to this headline">¶</a></h2>
<p>Pythonにおいて，最も重要な役割を果たすものの１つである，　<tt class="docutils literal"><span class="pre">Class</span></tt> について学びましょう.</p>
<div class="section" id="class">
<h3>6.1.1. 簡単なClassの例<a class="headerlink" href="#class" title="Permalink to this headline">¶</a></h3>
<p>まずは，最も簡単な <tt class="docutils literal"><span class="pre">Class</span></tt> を例にあげてみます．</p>
<p>以下では，消費者のWealthを入力する， <tt class="docutils literal"><span class="pre">Class</span></tt> を考えます．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Consumer</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">pass</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>このような， <tt class="docutils literal"><span class="pre">Class</span></tt> は以下のように動作します．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">()</span>  <span class="c"># インスタンスをつくる</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">wealth</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">wealth</span>
<span class="go">10</span>
</pre></div>
</div>
<p>最初に <tt class="docutils literal"><span class="pre">class</span></tt> と打ち込むのは，classを定義を宣言するためです．
<a href="#id1"><span class="problematic" id="id2">``</span></a>pass``　は何もしない操作，null operationと呼ばれ，空の定義をするときに使います．</p>
<p><tt class="docutils literal"><span class="pre">Class</span></tt> を定義する分では，インスタンスを定義しなくては行けませんが（インスタンスついては後述します），この例では，インスタンスの導入を後からしたかったので， <tt class="docutils literal"><span class="pre">pass</span></tt> を用いました．</p>
<p><strong>passの必要性</strong></p>
<p>passの必要性は，以下の関数の定義の例を考えてみれば，実感できるでしょう．</p>
<p>関数をその定義を未定義のまま行います．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">hoge</span><span class="p">):</span>
<span class="go">    File &quot;&lt;ipython-input-4-6d64f3c8a06a&gt;&quot;, line 1</span>
<span class="go">        def f(arg):</span>
<span class="go">                    ^</span>
<span class="go">SyntaxError: unexpected EOF while parsing</span>
</pre></div>
</div>
<p>とエラーがでてしまいますが，<a href="#id3"><span class="problematic" id="id4">``</span></a>pass``　をつかうと，</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
</div>
<p>そもそも関数の定義自体を行わないので，エラーメッセージは出ません．</p>
<p><strong>Consumer classの中身</strong></p>
<p>次に，作った <tt class="docutils literal"><span class="pre">Consumer</span> <span class="pre">Class</span></tt> の中身をみてみましょう．．</p>
<p><tt class="docutils literal"><span class="pre">dir()</span></tt> で機能を尋ねることができます．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">Consumer</span><span class="p">)</span>
<span class="go">[&#39;__doc__&#39;, &#39;__module__&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>6.1.2. 用語についての説明<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>class definition(クラスの定義)では， <tt class="docutils literal"><span class="pre">class</span></tt> をどのようなものにするかの設計図を書きます．</p>
<p>そこでは，</p>
<blockquote>
<div><ul class="simple">
<li>どんなdataを格納するか</li>
<li>どんなmethodを，格納したdataに対して働かせるか</li>
</ul>
</div></blockquote>
<p>を定義します．</p>
<p>インスタンス（オブジェクト） は <tt class="docutils literal"><span class="pre">Class</span></tt> を具現化したもので，class definition で作られます．インスタンスは，</p>
<blockquote>
<div><ul class="simple">
<li>特定のdataを持ち</li>
<li>class definition で与えられた，methodが働きかける対象</li>
</ul>
</div></blockquote>
<p>です．</p>
<p>Pythonでは，dataもmethodも，同じようにattributeと呼びます．この，attribute 同士は <tt class="docutils literal"><span class="pre">.</span></tt> を通して作用し合います．</p>
<p>例えば，</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">object_name.data</span></tt></li>
<li><tt class="docutils literal"><span class="pre">object_name.method_name()</span></tt></li>
</ul>
</div></blockquote>
<p>というようにです．</p>
<p>もう少し，具体的な例でみてみると，:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">__class__</span>
<span class="go">list</span>
</pre></div>
</div>
<p>というような，働きをします．</p>
<p>一行目では， <tt class="docutils literal"><span class="pre">x</span></tt> がインスタンスとして働きます．そして，特定のデータを持つ， <tt class="docutils literal"><span class="pre">list</span></tt> が格納されていることがわかると思います．それにたいして，組み込み関数の <tt class="docutils literal"><span class="pre">sort()</span></tt> を作用させ，中身を昇順に並べ替えます．xがどのようなデータを持つインスタンスかは， <tt class="docutils literal"><span class="pre">__class__</span></tt> というattributeを作用させることで調べることができます．また，先のように　<tt class="docutils literal"><span class="pre">dir()</span></tt> を使えば <tt class="docutils literal"><span class="pre">x</span></tt> のすべてのattributeをみることができます．</p>
</div>
<div class="section" id="class-another-consumer-class">
<h3>6.1.3. もう少し複雑なClassの例(Another Consumer Class)<a class="headerlink" href="#class-another-consumer-class" title="Permalink to this headline">¶</a></h3>
<p>最初に定義した <tt class="docutils literal"><span class="pre">class</span></tt> よりも，複雑な <tt class="docutils literal"><span class="pre">class</span></tt> を定義してみましょう．</p>
<p>その， <tt class="docutils literal"><span class="pre">class</span></tt> では， <tt class="docutils literal"><span class="pre">consumer</span></tt> が所得を獲得し，支出をおこないます．</p>
<p>まずは，その定義を最初に提示して，詳しく内容をみてみましょう．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Consumer</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="s">&quot;Initialize consumer with w dollars of wealth&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wealth</span> <span class="o">=</span> <span class="n">w</span>

    <span class="k">def</span> <span class="nf">earn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">&quot;The consumer earns y dollars&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wealth</span> <span class="o">+=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">spend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="s">&quot;The consumer spends x dollars if feasible&quot;</span>
        <span class="n">new_wealth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wealth</span> <span class="o">-</span> <span class="n">x</span>
        <span class="k">if</span> <span class="n">new_wealth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Insufficent funds&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wealth</span> <span class="o">=</span> <span class="n">new_wealth</span>
</pre></div>
</div>
<p>最初の <tt class="docutils literal"><span class="pre">def</span> <span class="pre">__init__(self,</span> <span class="pre">w):</span></tt> ブロックでは，インスタンスの初期化を行っています．そでは， <tt class="docutils literal"><span class="pre">w</span></tt> というインスタンスが導入され， <tt class="docutils literal"><span class="pre">self.wealth</span> <span class="pre">=</span> <span class="pre">w</span></tt> で <tt class="docutils literal"><span class="pre">self.wealth</span></tt> に <tt class="docutils literal"><span class="pre">w</span></tt> が代入され， <a href="#id6"><span class="problematic" id="id7">``</span></a>class``　の中で自由に呼び出され，methodと作用し合います．</p>
<p>次の， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">earn(self,</span> <span class="pre">y):</span></tt> は <tt class="docutils literal"><span class="pre">earn</span></tt> というmethodの定義を行っています． <tt class="docutils literal"><span class="pre">y</span></tt> という値を <a href="#id8"><span class="problematic" id="id9">``</span></a>self.wealth``　に足し合わせる操作が行われていることがわかるでしょう．文字通り，yという値をearnしているというわけです．</p>
<p>最後に， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">spend(self,</span> <span class="pre">x):</span></tt> では，支出 <tt class="docutils literal"><span class="pre">x</span></tt> を行うmethodを定義しています．ここでは，自分の所得以上の支出を行わないように定義しているので，もし，支出した後の所得，つまり　<tt class="docutils literal"><span class="pre">self.wealth``　から，``x</span></tt>
を差し引いた新たな値， <tt class="docutils literal"><span class="pre">new_wealth</span></tt> が負の値なら， <tt class="docutils literal"><span class="pre">&quot;Insufficent</span> <span class="pre">funds&quot;</span></tt> というメッセージを出すように出来ています．</p>
<p>それでは，実際にこの <tt class="docutils literal"><span class="pre">Consumer</span> <span class="pre">Class</span></tt> の動きを見てみましょう:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span> <span class="o">=</span> <span class="n">Consumer</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>で最初にインスタンを入れます．この時，当然ながら，所得は:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">wealth</span>
<span class="go">10</span>
</pre></div>
</div>
<p>です．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">spend</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">wealth</span>
<span class="go">5</span>
</pre></div>
</div>
<p>所得以上の支出をしようとすると，:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">spend</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go">Insufficent funds</span>
</pre></div>
</div>
<p>となることも確認できました．</p>
<p>ところで，この <tt class="docutils literal"><span class="pre">class</span></tt> は <tt class="docutils literal"><span class="pre">dictionary</span> <span class="pre">type</span></tt> のdata setです．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c1</span><span class="o">.</span><span class="n">__dict__</span>
<span class="go">{&#39;wealth&#39;: 20}</span>
</pre></div>
</div>
<p><em>書いていない項目がある</em></p>
</div>
<div class="section" id="the-solow-growth-model">
<h3>6.1.4. The Solow Growth Model<a class="headerlink" href="#the-solow-growth-model" title="Permalink to this headline">¶</a></h3>
<p><strong>ソローモデルの概要</strong></p>
<p>ここでは，経済学を勉強する人なら，必ずといっていいほど勉強する，ソローモデルをシュミュレーションする，classを作ります．実は，QuantEcon package　には今から作るものよりも，高度なソローモデルのコードがありますが，ここでは簡易的なものを作ってみましょう．</p>
<p>ソローモデルは，以下の様な式で表されることを思い出しましょう．</p>
<div class="math">
\[k_{t+1} = \frac{s z k^{\alpha}_t}{1 + n}  + k_t \frac{1 - d}{1 + n}\]</div>
<p>ノーテンションの説明は以下のとおりです．</p>
<blockquote>
<div><ul class="simple">
<li>s は外生的に決まる貯蓄率</li>
<li>z は生産性を表すパラメーター</li>
<li>α は所得における資本分配率</li>
<li>n は人口成長率</li>
<li>d は資本減耗率</li>
</ul>
</div></blockquote>
<p>所で，ソローモデルでの分析では，定常状態が大きな役割を果たすのでした．</p>
<p>ソローモデルにおける定常状態とは，</p>
<div class="math">
\[k_{t+1} = k_{t}=k\]</div>
<p>となって，kが変化しなくなるような点のことでした．</p>
<p>この，定常状態がどのような値になるのかは，外生的に与えられている変数がどのような値かによって決まります．逆にいうと，定常状態が変化は，外生変数の変化によってもたらされるのです．</p>
<p><strong>class solowの説明</strong></p>
<p>ソローモデルのコードは以下のようなものです．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filename: solow.py</span>
<span class="sd">Reference: http://quant-econ.net/py/python_oop.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>  <span class="c"># Omit for Python 3.x</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">Solow</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the Solow growth model with update rule</span>

<span class="sd">    .. math::</span>
<span class="sd">        k_{t+1} = \frac{s z k^{\alpha}_t}{1 + n}  + k_t \frac{1 + d}{1 + n}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solow growth model with Cobb Douglas production function.  All</span>
<span class="sd">        parameters are scalars.  See http://quant-econ.net/py/python_oop.html</span>
<span class="sd">        for interpretation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="c">#coding style　PEP8</span>

    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="s">&quot;Evaluate the h function&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Update the current state (i.e., the capital stock).&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">steady_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="s">&quot;Compute the steady state value of capital.&quot;</span>
         <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">generate_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="s">&quot;Generate and return a time series of length t&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
<p>また，順にコードをみていきましょう．まず， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">__init__(self,</span> <span class="pre">n,</span> <span class="pre">s,</span> <span class="pre">d,</span> <span class="pre">alpha,</span> <span class="pre">z,</span> <span class="pre">k):</span></tt> ですが，インスタンスの初期化ですね．ここでは，6つのインスタンスが導入されています．</p>
<p>次に， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">h(self,x):</span></tt> ですが，ここでは，これは，最初にあげたソローモデルの式を計算しています．式の　<span class="math">\(k_{t+1}\)</span> をhに， <span class="math">\(k_t\)</span> をxに置き換えると理解しやすいでしょう．イメージとしては，t期の状態の資本ｋをt+1の状態にアップデートするのが，hなのです．こうすることで,期間ごとの資本の値を計算し，グラフにプロットすることができます．</p>
<p>その，アップデートするmethodが <tt class="docutils literal"><span class="pre">def</span> <span class="pre">update(self):</span></tt> です．インスタンスの <tt class="docutils literal"><span class="pre">self.k</span></tt> を先に定義した <tt class="docutils literal"><span class="pre">h</span></tt> に入れます． <tt class="docutils literal"><span class="pre">class</span></tt> の中で定義したmethodを別のmethodの定義で使うときは，　<tt class="docutils literal"><span class="pre">self.h(self.k)</span></tt> と <tt class="docutils literal"><span class="pre">self</span></tt> を付けなくてはいけないことに注意してください．また，あるmethodの定義に，別の定義がなされたmethodを用いるときには特に先に定義しておく必要はありません．つまり，ここでは，
<tt class="docutils literal"><span class="pre">def</span> <span class="pre">update(self):</span></tt> の前に必ず， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">update(self):</span></tt> を書かなくては行けないということはありません．pythonは,classの定義をすべて読み込んでから，classの内容を動かすからです．</p>
<p>次の， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">steady_state(self):</span></tt> は定常状態を計算するmethodですこれは予め定常状態の式を計算したものを書いただけです．これは，先の <tt class="docutils literal"><span class="pre">h</span></tt> についても言えることですが，最初のソローモデルの式を書き換えたりした場合は正確な結果が出るわけでは無いことに注意してください．</p>
<p>最後の， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">generate_sequence(self,</span> <span class="pre">t):</span></tt> はkの動きを計算した流列を作るメソッドです．どれくらいの長さを取るかを <tt class="docutils literal"><span class="pre">t</span></tt> で指定して， <tt class="docutils literal"><span class="pre">for</span></tt> で計算します．</p>
<p><strong>ソローモデルのグラフを書いてみる</strong></p>
<p>以上が，solow model　をシュミュレーションしたclassです．せっかくなので，これを計算して，定常状態に行き着くまでのグラフを書いてみましょう．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">baseline_params</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">Solow</span><span class="p">(</span><span class="o">*</span><span class="n">baseline_params</span><span class="p">)</span>  <span class="c"># The &#39;splat&#39; operator * breaks up the tuple</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">Solow</span><span class="p">(</span><span class="o">*</span><span class="n">baseline_params</span><span class="p">)</span>
<span class="n">s2</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mf">8.0</span>  <span class="c"># Reset s2.k to make high capital economy</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c"># Plot the common steady state value of capital</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s1</span><span class="o">.</span><span class="n">steady_state</span><span class="p">()]</span><span class="o">*</span><span class="n">T</span><span class="p">,</span> <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;steady state&#39;</span><span class="p">)</span>
<span class="c"># Plot time series for each economy</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">:</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="s">&#39;capital series from initial state {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">generate_sequence</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s">&#39;o-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lb</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>この内容を簡単に見てみましょう．まずは， <tt class="docutils literal"><span class="pre">import</span> <span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt</span></tt> で図を書くために <tt class="docutils literal"><span class="pre">matplotlib.pyplot</span></tt> を <tt class="docutils literal"><span class="pre">import</span></tt> します．次に， <tt class="docutils literal"><span class="pre">baseline_params</span></tt> で先にインスタンスのセットを揃えておき， <tt class="docutils literal"><span class="pre">s1</span></tt> , <tt class="docutils literal"><span class="pre">s2</span></tt> と２つの式を見比べてます．このままでは，同じ式ですが， <tt class="docutils literal"><span class="pre">s2.k</span> <span class="pre">=</span> <span class="pre">8.0</span></tt> として， <tt class="docutils literal"><span class="pre">s1</span></tt> よりも，資本を多く持っている状態でスタートさせてみましょう．</p>
<p>流列の長さ <tt class="docutils literal"><span class="pre">T</span></tt> は，60にします．わかりやすいように，定常状態の水準を， <tt class="docutils literal"><span class="pre">ax.plot([s1.steady_state()]*T,</span> <span class="pre">'k-',</span> <span class="pre">label='steady</span> <span class="pre">state')</span></tt> で補助線として引いておきましょう．最後に， <tt class="docutils literal"><span class="pre">for</span></tt> と　<tt class="docutils literal"><span class="pre">ax.plot</span></tt> の合わせ技で，プロットしていきます． <tt class="docutils literal"><span class="pre">ax.legend</span></tt> は凡例を意味し，どこに置くかは指定できますし， <tt class="docutils literal"><span class="pre">ax.legend(loc='best')</span></tt> とすればベストな位置においてくれます．</p>
<p>実行すると，以下のように画像が出力されます．</p>
<a class="reference internal image-reference" href="../../_images/solow.png"><img alt="solow" src="../../_images/solow.png" style="width: 480.0px; height: 360.0px;" /></a>
</div>
<div class="section" id="a-market">
<h3>6.1.5. A Market<a class="headerlink" href="#a-market" title="Permalink to this headline">¶</a></h3>
<p><strong>class Marketですること</strong></p>
<p>次は，市場をシュミュレーションする <tt class="docutils literal"><span class="pre">class</span></tt> をかいてみましょう．市場といっても，記述するのは需要関数と供給関数は線形の２本の方程式をグラフに描いて，余剰計算を行う簡単なものです．</p>
<p>式にしてまうと，</p>
<div class="math">
\[Q = a_{d} - d_{d}p\]\[Q = a_{z} - d_{z}(p-t)\]</div>
<p>の２本の式です．Qは数量，pは価格，a,dは需給関数それぞれのパラメーターです．供給関数にはtで表されている，重量税が入っています．</p>
<p>少し長いですが，この市場をシュミュレーションする <tt class="docutils literal"><span class="pre">class</span></tt> をみてみましょう．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="k">class</span> <span class="nc">Market</span><span class="p">:</span>

<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ad</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">,</span> <span class="n">tax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set up market parameters.  All parameters are scalars.  See</span>
<span class="sd">    http://quant-econ.net/py/python_oop.html for interpretation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tax</span> <span class="o">=</span> <span class="n">ad</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">bz</span><span class="p">,</span> <span class="n">tax</span>
    <span class="k">if</span> <span class="n">ad</span> <span class="o">&lt;</span> <span class="n">az</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Insufficient demand.&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&quot;Return equilibrium price&quot;</span>
    <span class="k">return</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ad</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tax</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&quot;Compute equilibrium quantity&quot;</span>
    <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">ad</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">bd</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">consumer_surp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&quot;Compute consumer surplus&quot;</span>
    <span class="c"># == Compute area under inverse demand function == #</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ad</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bd</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bd</span><span class="p">)</span><span class="o">*</span> <span class="n">x</span>
    <span class="n">area</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">area</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">price</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">producer_surp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&quot;Compute producer surplus&quot;</span>
    <span class="c">#  == Compute area above inverse supply curve, excluding tax == #</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">area</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">price</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tax</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span> <span class="o">-</span> <span class="n">area</span>

<span class="k">def</span> <span class="nf">taxrev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s">&quot;Compute tax revenue&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tax</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">inverse_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s">&quot;Compute inverse demand&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ad</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bd</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bd</span><span class="p">)</span><span class="o">*</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">inverse_supply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s">&quot;Compute inverse supply curve&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tax</span>

<span class="k">def</span> <span class="nf">inverse_supply_no_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s">&quot;Compute inverse supply curve without tax&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">bz</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>
</div>
<p>簡単に説明を加えておきます．基本的には予め計算しておいた，均衡の値を書き込んでいるだけです．余剰に関しても，三角形の面積で計算したものを書き込めば結果はでますが， <tt class="docutils literal"><span class="pre">from</span> <span class="pre">scipy.integrate</span> <span class="pre">import</span> <span class="pre">quad</span></tt>
として， <tt class="docutils literal"><span class="pre">scipy</span></tt> （さいふぁい）で積分計算をしています．</p>
<p>順に， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">price(self):</span></tt> と　<tt class="docutils literal"><span class="pre">def</span> <span class="pre">quantity(self):</span></tt> は均衡の価格と数量の式を入れて計算するmethodが定義されていて， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">consumer_surp(self):</span></tt> と　<tt class="docutils literal"><span class="pre">def</span> <span class="pre">producer_surp(self):</span></tt> は消費者と生産者の余剰を積分計算しています． <tt class="docutils literal"><span class="pre">def</span> <span class="pre">taxrev(self):</span></tt> は税収です．tは重量税なので，均衡数量にtをかけて求めることができます．</p>
<p><tt class="docutils literal"><span class="pre">def</span> <span class="pre">inverse_demand(self,x):</span></tt> と <tt class="docutils literal"><span class="pre">def</span> <span class="pre">inverse_supply(self,x):</span></tt> は逆需給関数です．これは，グラフを書きたいがために定義しておくmethodです．マーシャル以降，縦に価格，横にxを描き，価格から数量を読む，通常とは逆のグラフの読み方をするのが慣習になっていることを思い出してください．最後に， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">inverse_supply_no_tax(self,x):</span></tt> が税がなかった場合の供給曲線です．これを定義しておくことで，税を導入することによる死荷重を計算することができます</p>
<p><strong>class Marketで受給曲線のグラフをかく</strong></p>
<p>このclassを使って，グラフを書き，余剰分析をしてみましょう．まずは，需給関数の内容を指定しておきます．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">baseline_params</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Market</span><span class="p">(</span><span class="o">*</span><span class="n">baseline_params</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="n">baseline_params</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>とりあえず，均衡価格と均衡数量を見ておきましょう:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;equilibrium price = &quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">price</span><span class="p">()</span>
<span class="go">equilibrium price =  18.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;consumer surplus = &quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">consumer_surp</span><span class="p">()</span>
<span class="go">consumer surplus =  33.0625</span>
</pre></div>
</div>
<p>グラフをかくために，以下のコードを実行します．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">market</span> <span class="kn">import</span> <span class="n">Market</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">q_max</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">quantity</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">q_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">q_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pd</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">inverse_demand</span><span class="p">(</span><span class="n">q_grid</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">inverse_supply</span><span class="p">(</span><span class="n">q_grid</span><span class="p">)</span>
<span class="n">psno</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">inverse_supply_no_tax</span><span class="p">(</span><span class="n">q_grid</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_grid</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;demand&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_grid</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;supply&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q_grid</span><span class="p">,</span> <span class="n">psno</span><span class="p">,</span> <span class="s">&#39;:o&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;supply without tax&#39;</span><span class="p">)</span><span class="c">#&#39;:o&#39;のところを色々かえると線を指定できる</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;quantity&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_max</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;price&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span><span class="c">#凡例,bestと指定すると，いい感じになる．</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/market.png"><img alt="market" src="../../_images/market.png" style="width: 480.0px; height: 360.0px;" /></a>
<p>先ほどの，ソローモデルのグラフを描いたときと同じ内容ですので，詳しい説明は省きます．しかし，いくつかコメントをする必要のある部分もあります． <tt class="docutils literal"><span class="pre">%matplotlib</span> <span class="pre">inline</span></tt> はたとえばipythonだと，ブラウザの中に画像を出力してくれるコードです．別ウインドウで表示させるよりも便利なことがあるので覚えておくといいでしょう．また， <tt class="docutils literal"><span class="pre">plot</span></tt> の線を指定することもできます． 例えば，<tt class="docutils literal"><span class="pre">#':o'のところを色々かえると線をしていできる</span></tt> と描いている行で， <tt class="docutils literal"><span class="pre">':o'</span></tt> を <tt class="docutils literal"><span class="pre">'+k'</span></tt> に変えてみてください．</p>
<p><strong>class Marketを使って死荷重を計算する関数を定義してみる</strong></p>
<p>せっかくなので，死荷重を計算してみましょう．classでは死荷重を計算するmethodは定義していませんでしたが，新しく関数を定義してあげてます．classを呼び出して，そのmethodを使って関数を新たに定義するわけです．そのために， <tt class="docutils literal"><span class="pre">from</span> <span class="pre">market</span> <span class="pre">import</span> <span class="pre">Market</span></tt> として，classを呼び出します．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">market</span> <span class="kn">import</span> <span class="n">Market</span>

<span class="k">def</span> <span class="nf">deadw</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="s">&quot;Computes deadweight loss for market m.&quot;</span>
    <span class="c"># == Create analogous market with no tax == #</span>
    <span class="n">m_no_tax</span> <span class="o">=</span> <span class="n">Market</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ad</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">bd</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">az</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">bz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c"># == Compare surplus, return difference == #</span>
    <span class="n">surp1</span> <span class="o">=</span> <span class="n">m_no_tax</span><span class="o">.</span><span class="n">consumer_surp</span><span class="p">()</span> <span class="o">+</span> <span class="n">m_no_tax</span><span class="o">.</span><span class="n">producer_surp</span><span class="p">()</span>
    <span class="n">surp2</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">consumer_surp</span><span class="p">()</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">producer_surp</span><span class="p">()</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">taxrev</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">surp1</span> <span class="o">-</span> <span class="n">surp2</span>
</pre></div>
</div>
<p>以上のようなコードを実行すると，:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">deadw</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>  <span class="c"># Show deadweight loss</span>
<span class="go">1.125</span>
</pre></div>
</div>
<p>となって，死荷重が計算出来ました．</p>
</div>
<div class="section" id="chaos">
<h3>6.1.6. Chaos<a class="headerlink" href="#chaos" title="Permalink to this headline">¶</a></h3>
<p><strong>class Chaosの説明</strong></p>
<p>次は，Chaos（複雑系）をシミュレーションするclassをかいてみましょう．
次の式はロジスティック写像と呼ばれ，人口や細菌の数といった生物の繁殖を記述した式です．数理生態学者のロバート・メイが，生態の個体数を調べるためにこの式を計算機で解いているときに，この式が，初期値によって，複雑な挙動を示すことを，見つけたそうです(<a class="reference external" href="http://www.kyoto-su.ac.jp/project/st/st11_01.html">参考文献 世界観を覆した数学理論</a>)．</p>
<div class="math">
\[x_{t+1}=r x_t (1−x_t),\;\;x0\in[0,1],r\in[0,4]\]</div>
<p>この，ロジステック写像をシミュレーションするclassは以下の様なものです．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filename: chaos_class.py</span>
<span class="sd">Reference: http://quant-econ.net/py/python_oop.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">class</span> <span class="nc">Chaos</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Models the dynamical system with :math:`x_{t+1} = r x_t (1 - x_t)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with state x0 and parameter r</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Apply the map to update state.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="s">&quot;Generate and return a sequence of length n.&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
<p>インスタンスの初期化を行い， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">update(self):</span></tt>  でxをアップデートするのも， <tt class="docutils literal"><span class="pre">def</span> <span class="pre">generate_sequence(self,</span> <span class="pre">n):</span></tt> で流列をつくるのも，<tt class="docutils literal"><span class="pre">class</span> <span class="pre">solow</span></tt> でやったのと同じです．</p>
<p>試しに，流列の最初の5つをみてみましょう．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ch</span> <span class="o">=</span> <span class="n">Chaos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span> <span class="c"># x0 = 0.1 and r = 0.4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ch</span><span class="o">.</span><span class="n">generate_sequence</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c"># First 5 iterates</span>
<span class="go">[0.1, 0.36000000000000004, 0.9216, 0.28901376000000006, 0.8219392261226498]</span>
</pre></div>
</div>
<p>振動していることがわかると思います．</p>
<p>これを，グラフにプロットしてみましょう．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filename: choatic_ts.py</span>
<span class="sd">Reference: http://quant-econ.net/py/python_oop.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">chaos_class</span> <span class="kn">import</span> <span class="n">Chaos</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">ch</span> <span class="o">=</span> <span class="n">Chaos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="n">ts_length</span> <span class="o">=</span> <span class="mi">250</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$x_t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">generate_sequence</span><span class="p">(</span><span class="n">ts_length</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ts_length</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="s">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">r&#39;$x_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/chaos1.png"><img alt="chaos1" src="../../_images/chaos1.png" style="width: 480.0px; height: 360.0px;" /></a>
<p>次に分岐図を書いてみましょう．縦に，ｘの値を縦軸に，パラメーターrの値を横軸にとります．</p>
<p>ある値で，2つに分岐し，また，さらにある値を超えると複雑な分岐をし始めるのがわかると思います．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filename: bifurcation_diagram.py</span>
<span class="sd">Reference: http://quant-econ.net/py/python_oop.html</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">chaos_class</span> <span class="kn">import</span> <span class="n">Chaos</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">Chaos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="k">while</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">ch</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">generate_sequence</span><span class="p">(</span><span class="mi">1000</span><span class="p">)[</span><span class="mi">950</span><span class="p">:]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="s">&#39;b.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">0.005</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$r$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/chaos2.png"><img alt="chaos2" src="../../_images/chaos2.png" style="width: 480.0px; height: 360.0px;" /></a>
</div>
</div>
<div class="section" id="special-methods">
<h2>6.2. Special Methods<a class="headerlink" href="#special-methods" title="Permalink to this headline">¶</a></h2>
<p>Pythonで使える，ちょっとした小ワザ（tricks）を紹介しましょう． Exercisesでこの小ワザを使うので，最初はその内容が捉えにくく感じても，心配する必要はありません．</p>
<p>それは，以下の様なものです．まず， <tt class="docutils literal"><span class="pre">len()</span></tt> を考えてみましょう．:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>のように，listやtupleの要素の数を出すのが <tt class="docutils literal"><span class="pre">len()</span></tt> でした．次に，以下の様なclassを定義します．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>

<span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">42</span>
</pre></div>
</div>
<p>このクラスでは <tt class="docutils literal"><span class="pre">len</span></tt> は，42という数字を返します．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">42</span>
</pre></div>
</div>
<p>ここまでは，自然に理解できるでしょう．では，この <tt class="docutils literal"><span class="pre">len</span></tt> の定義の中に，新たに変数を入れるとどうでしょうか．つまり，</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">42</span>
</pre></div>
</div>
<p>という感じです，ここで使われているのは，<tt class="docutils literal"><span class="pre">__call__method</span></tt> というものです．厳密さを犠牲にして，イメージを伝えると．classの中のmethodに新たに関数を定義するような操作です．</p>
<p>こうすることで，:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt;&gt;&gt; f = Foo()
&gt;&gt;&gt; f(8)　# Exactly equivalent to f.__call__(8)
50
</pre></div>
</div>
<p>とできます．</p>
<p>この，小ワザを使って，以下の2題のExercisesを解いてみましょう．</p>
</div>
<div class="section" id="exercises">
<h2>6.3. Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exercise-1">
<h3>6.3.1. Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>与えられた標本，<span class="math">\(\{X_i\}^{n}_{i=1}\)</span> に対する，the empirical cumulative distribution function(経験累積分布関数)を定義する問題.　一般的に，ECDFと呼ばれるようです．</p>
<p>ECDFは以下の様な関数です．</p>
<div class="math">
\[F_{n}(x) \equiv (1/n)\sum^{n}_{i=1} \mathbb{1} \{x_{i} \leq x\} \;\;\; (x\in \mathbb{R})\]</div>
<p>この，ECDFは， <span class="math">\(X_i\)</span>  が与えられた基準x以下なら1，それ以外だったら0をたしていく関数です．そして，サンプルがiidならば，F_n の確率分布が，そのサンプルが従う真の確率分布に収束していくことが，The Glivenko–Cantelli Theoremによって保証されています．</p>
<p>そのような，特徴を持つECDFのclassを定義するのですが，問題文には以下の2点の指定があります．</p>
<blockquote>
<div><ul class="simple">
<li><span class="math">\(\{X_i\}^{n}_{i=1}\)</span> はインスタンスとして与えられるものとして， <tt class="docutils literal"><span class="pre">self.observations</span></tt> に格納する．</li>
<li><tt class="docutils literal"><span class="pre">__call__method</span></tt> を使って，<span class="math">\(F_n(x)\)</span> として基準 <tt class="docutils literal"><span class="pre">ｘ</span></tt> を指定して計算できるようにする</li>
</ul>
</div></blockquote>
<p>ということです．問題では，以下の様な動作をするようにと例を挙げてくれています:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">uniform</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">F</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">F</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c"># Evaluate ecdf at x = 0.5</span>
<span class="go">0.29</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">F</span><span class="o">.</span><span class="n">observations</span> <span class="o">=</span> <span class="p">[</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">F</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">0.479</span>
</pre></div>
</div>
<p>この問題は，ECDFというよりも，<tt class="docutils literal"><span class="pre">__call__method</span></tt> を上手く使えるようになるための練習のようです．</p>
<p>解答例は以下の通りです．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Exercises 1</span>

<span class="sd">The empirical cumulative function class</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">ECDF</span><span class="p">:</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with given sample self.observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observations</span> <span class="o">=</span> <span class="n">observations</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>

        <span class="s">&quot;compute F_n&quot;</span>
        <span class="s">&quot;criteria x&quot;</span>

        <span class="n">F_n</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span>

        <span class="n">F_n</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F_n</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">for</span></tt> のなかの，条件分岐の <tt class="docutils literal"><span class="pre">if</span></tt> の <tt class="docutils literal"><span class="pre">else:</span></tt> 以下ですが，本質的には必要ありません．<tt class="docutils literal"><span class="pre">if</span></tt> の条件式を満たしていなければ何もしないからです．今回は，練習のため，ECDFの動き“基準以上なら0をたす”という部分を意識して書きました．本来はこのような，無用なコードは避けるべきでしょう．</p>
</div>
<div class="section" id="exercise-2">
<h3>6.3.2. Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Polynomial（多項式）の再来です．前回のExercisesでもPolynomialは扱いましたので内容の説明は省きます．以下の様な関数です，</p>
<div class="math">
\[p(x)= a_{0} + a_{1}x + a_{2}x^{2}+ ... +a_{N}x^{N} = \sum^{N}_{m=0} a_{n}x^{n} \;\;\; (x\in\mathbb{R})\]</div>
<p>前回は関数を定義する問題でしたが，今回はclassを定義する問題です．以下の様な指示が与えられています，</p>
<blockquote>
<div><ul class="simple">
<li>p(x)というように打ち込んだら，Polynomialを計算するようにしなさい</li>
<li>与えられた，係数を入れ替える事によって，p(x)を微分しなさい（微分した値を計算するようにしなさい）</li>
</ul>
</div></blockquote>
<p>当然ですが， <tt class="docutils literal"><span class="pre">import</span></tt> を使ってはいけませんよとの但し書きもあります．</p>
<p>以下に解答例をあげます．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Exercises 2</span>

<span class="sd">The polinomial class</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Polynomial</span><span class="p">:</span>


<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize with given sample self.coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span>

<span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>

    <span class="s">&quot;compute F_n&quot;</span>
    <span class="s">&quot;criteria x&quot;</span>


    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">for</span> <span class="n">n</span> <span class="p">,</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">):</span>
         <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">a_i</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">n</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">dif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>

    <span class="n">s</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="p">,</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">a_i</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">update</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="p">,</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">update</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">a_i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Polynomial</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, akira.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>